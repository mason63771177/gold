<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>è£‚é‡‘7æ—¥ Â· ç™»å½•æ³¨å†Œ</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QQ6GQ79K7G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-QQ6GQ79K7G');
  </script>
  
  <link rel="stylesheet" href="css/global-background.css">
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111823;
      --card:#0e141d;
      --brand:#56ccf2;
      --brand-2:#2f80ed;
      --text:#e6efff;
      --muted:#9fb3cd;
      --danger:#ff5d5d;
      --ok:#1ed760;
      --safe: env(safe-area-inset-bottom, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%;background:var(--bg);color:var(--text);margin:0;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",PingFang SC,Helvetica,Arial,"Microsoft Yahei",sans-serif;}
    .app{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:24px;}
    h1{margin-top:60px;margin-bottom:24px;font-size:24px;font-weight:700;letter-spacing:1px;text-align:center;color:var(--brand);}

    /* logo æ ·å¼ */
    .logo-small {
      width: 80px;
      height: 80px;
      object-fit: contain;
      display: block;
      margin: 0 auto 16px auto;
    }

    .card{
      background:var(--card);
      border-radius:16px;
      padding:24px;
      width:100%;
      max-width:360px;
      box-shadow:0 8px 32px rgba(0,0,0,0.3);
      border:1px solid rgba(255,255,255,0.1);
    }
    .card > div{margin-bottom:16px;}
    .card > div:last-child{margin-bottom:0;}
    label{display:block;margin-bottom:8px;font-size:14px;font-weight:500;color:var(--text);}
    input{
      width:100%;
      padding:12px 16px;
      border:1px solid rgba(255,255,255,0.15);
      border-radius:8px;
      background:rgba(255,255,255,0.05);
      color:var(--text);
      font-size:16px;
      transition:all 0.2s ease;
    }
    input:focus{
      outline:none;
      border-color:var(--brand);
      background:rgba(255,255,255,0.08);
    }
    input::placeholder{color:var(--muted);}
    .btn{
      width:100%;
      padding:14px;
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      color:#fff;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition:all 0.2s ease;
      margin-top:8px;
    }
    .btn:hover{
      transform:translateY(-1px);
      box-shadow:0 4px 16px rgba(86,204,242,0.3);
    }
    .btn:active{transform:translateY(0);}
    .note{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.4;}
    .foot{
      margin-top:40px;
      text-align:center;
      font-size:12px;
      color:var(--muted);
    }
    
    /* åˆ‡æ¢æŒ‰é’®æ ·å¼ */
    .tab-container {
      display: flex;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 4px;
      margin-bottom: 24px;
    }
    .tab-btn {
      flex: 1;
      padding: 10px;
      background: transparent;
      color: var(--muted);
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .tab-btn.active {
      background: var(--brand);
      color: #fff;
    }
    
    /* è¡¨å•åˆ‡æ¢ */
    .form-container {
      display: none;
    }
    .form-container.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- logo å›¾åƒ -->
    <img src="logo_gold7.png" alt="Logo" class="logo-small" />
    <h1>è£‚é‡‘7æ—¥</h1>
    
    <div class="card">
      <!-- åˆ‡æ¢æ ‡ç­¾ -->
      <div class="tab-container">
        <button class="tab-btn active" onclick="switchTab('login')">ç™»å½•</button>
        <button class="tab-btn" onclick="switchTab('register')">æ³¨å†Œ</button>
      </div>
      
      <!-- ç™»å½•è¡¨å• -->
      <div id="loginForm" class="form-container active">
        <div>
          <label for="loginEmail">é‚®ç®±</label>
          <input id="loginEmail" type="email" placeholder="è¯·è¾“å…¥é‚®ç®±" />
        </div>
        <div>
          <label for="loginPassword">å¯†ç </label>
          <input id="loginPassword" type="password" placeholder="è¯·è¾“å…¥å¯†ç " />
        </div>
        <button class="btn" id="loginBtn">ç«‹å³ç™»å½•</button>
        <div class="note">ç™»å½•å³å¯ç»§ç»­æ‚¨çš„7å¤©æŒ‘æˆ˜ä¹‹æ—…</div>
      </div>
      
      <!-- æ³¨å†Œè¡¨å• -->
      <div id="registerForm" class="form-container">
        <div>
          <label for="registerEmail">é‚®ç®±</label>
          <input id="registerEmail" type="email" placeholder="è¯·è¾“å…¥é‚®ç®±" />
        </div>
        <div>
          <label for="registerPassword">å¯†ç </label>
          <input id="registerPassword" type="password" placeholder="è¯·è¾“å…¥å¯†ç " />
        </div>
        <div>
          <label for="inviteCode">é‚€è¯·ç </label>
          <input id="inviteCode" type="text" placeholder="è¯·è¾“å…¥é‚€è¯·ç " />
        </div>
        <button class="btn" id="registerBtn">ç«‹å³æ³¨å†Œ</button>
        <div class="note">æ³¨å†Œå³è¡¨ç¤ºæ‚¨å·²å¹´æ»¡18å²ï¼Œä¸”åŒæ„ç›¸å…³æœåŠ¡åè®®å’Œéšç§æ”¿ç­–ã€‚</div>
      </div>
    </div>
    
    <div class="foot">å¼€å¯æ‚¨çš„è´¢å¯Œå¢é•¿ä¹‹æ—…</div>
  </div>

  <script>
    // åˆ‡æ¢ç™»å½•/æ³¨å†Œè¡¨å•
    function switchTab(type) {
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const tabBtns = document.querySelectorAll('.tab-btn');
      
      // ç§»é™¤æ‰€æœ‰activeç±»
      tabBtns.forEach(btn => btn.classList.remove('active'));
      loginForm.classList.remove('active');
      registerForm.classList.remove('active');
      
      if (type === 'login') {
        tabBtns[0].classList.add('active');
        loginForm.classList.add('active');
      } else {
        tabBtns[1].classList.add('active');
        registerForm.classList.add('active');
      }
    }
    
    // è§£æé‚€è¯·ä»£ç  from querystring
    (function() {
      const params = new URLSearchParams(location.search);
      const inviteCode = params.get('invite') || params.get('code'); // æ”¯æŒä¸¤ç§å‚æ•°æ ¼å¼
      if(inviteCode) {
        // å¦‚æœæœ‰é‚€è¯·ç ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°æ³¨å†Œé¡µé¢
        switchTab('register');
        document.getElementById('inviteCode').value = inviteCode;
        document.getElementById('inviteCode').readOnly = true;
        
        // æ˜¾ç¤ºé‚€è¯·ä¿¡æ¯
        const inviteInfo = document.createElement('div');
        inviteInfo.style.cssText = 'background: rgba(86, 204, 242, 0.1); border: 1px solid var(--brand); border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 14px; color: var(--brand);';
        inviteInfo.innerHTML = `ğŸ‰ æ‚¨é€šè¿‡é‚€è¯·ç  <strong>${inviteCode}</strong> è¿›å…¥æ³¨å†Œ`;
        document.querySelector('#registerForm .card').insertBefore(inviteInfo, document.querySelector('#registerForm .card').firstChild);
      }
    })();
    
    // ç™»å½•åŠŸèƒ½
    document.getElementById('loginBtn').addEventListener('click', () => {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if(!email || !password) {
        alert('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ');
        return;
      }
      
      // ç®€å•æ ¡éªŒé‚®ç®±æ ¼å¼
      if(!/.+@.+\..+/.test(email)) {
        alert('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
        return;
      }
      
      // éªŒè¯ç”¨æˆ·ä¿¡æ¯
      const storedEmail = localStorage.getItem('userEmail');
      const storedPassword = localStorage.getItem('userPassword');
      
      if(storedEmail === email && storedPassword === password) {
        alert('ç™»å½•æˆåŠŸï¼');
        window.location.href = 'index.html';
      } else {
        alert('é‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•');
      }
    });
    
    // æ³¨å†ŒåŠŸèƒ½
    document.getElementById('registerBtn').addEventListener('click', () => {
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const invite = document.getElementById('inviteCode').value.trim();
      
      if(!email || !password || !invite) {
        alert('è¯·å®Œæ•´å¡«å†™ä¿¡æ¯');
        return;
      }
      
      // ç®€å•æ ¡éªŒé‚®ç®±æ ¼å¼
      if(!/.+@.+\..+/.test(email)) {
        alert('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
        return;
      }
      
      // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²æ³¨å†Œ
      const storedEmail = localStorage.getItem('userEmail');
      if(storedEmail === email) {
        alert('è¯¥é‚®ç®±å·²æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•');
        switchTab('login');
        document.getElementById('loginEmail').value = email;
        return;
      }
      
      // ä¿å­˜åˆ° localStorage (æ¨¡æ‹Ÿæ³¨å†Œ)
      localStorage.setItem('userEmail', email);
      localStorage.setItem('userPassword', password);
      localStorage.setItem('myInviterCode', invite); // ä¿å­˜é‚€è¯·æˆ‘çš„äººçš„é‚€è¯·ç 
      // è®¾ç½®çŠ¶æ€1 (æ–°æ‰‹æœªå…¥é‡‘)
      localStorage.setItem('userStatus', '1');
      
      // å»ºç«‹é‚€è¯·å…³ç³» - å°†è‡ªå·±æ·»åŠ åˆ°é‚€è¯·äººçš„å›¢é˜Ÿä¸­
      const inviteRelations = JSON.parse(localStorage.getItem('inviteRelations') || '{}');
      if (!inviteRelations[invite]) {
        inviteRelations[invite] = [];
      }
      inviteRelations[invite].push({
        email: email,
        joinTime: new Date().toISOString(),
        status: 'registered'
      });
      localStorage.setItem('inviteRelations', JSON.stringify(inviteRelations));
      
      alert('æ³¨å†ŒæˆåŠŸï¼å³å°†è·³è½¬é¦–é¡µ');
      window.location.href = 'index.html';
    });
    
    // å›è½¦é”®ç™»å½•/æ³¨å†Œ
    document.addEventListener('keypress', function(e) {
      if(e.key === 'Enter') {
        const activeForm = document.querySelector('.form-container.active');
        if(activeForm.id === 'loginForm') {
          document.getElementById('loginBtn').click();
        } else {
          document.getElementById('registerBtn').click();
        }
      }
    });
  </script>
  <script src="js/global-background.js"></script>
</body>
</html>