<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>裂金7日 · 答题任务</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QQ6GQ79K7G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-QQ6GQ79K7G');
  </script>
  
  <link rel="stylesheet" href="themes.css">
  <link rel="stylesheet" href="css/global-background.css">
  <script src="theme-switcher.js"></script>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #111823;
      --card: #0e141d;
      --brand: #56ccf2;
      --brand-2: #2f80ed;
      --text: #e6efff;
      --muted: #9fb3cd;
      --accent-border: rgba(111, 158, 255, 0.18);
      /* 安全区域适配：用于 iPhone X 等带底部凹槽设备 */
      --safe: env(safe-area-inset-bottom, 0px);
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      overflow: hidden;
    }
    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      position: relative;
      flex: 0 0 20%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding-top: 20px;
    }
    .back-btn {
      flex: 1;
      margin: 0 6px;
      border: none;
      border-radius: 16px;
      padding: 14px 0;
      font-size: 14px;
      font-weight: 800;
      color: var(--text);
      cursor: pointer;
      background-image: linear-gradient(180deg, #6c757d, #5a6268);
      box-shadow: 0 8px 24px rgba(108,117,125,0.45), inset 0 1px 0 rgba(255,255,255,0.25);
      transition: transform 0.08s ease, filter 0.2s ease;
      white-space: nowrap;
    }
    .back-btn:hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }
    .back-btn:active {
      transform: translateY(0);
      filter: brightness(0.95);
    }
    .header h1 {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(45deg, #2193b0, #6dd5ed);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 12px rgba(109,213,237,0.5)) drop-shadow(0 0 24px rgba(109,213,237,0.3));
      margin: 0;
    }
    /* 小logo样式 */
    .logo-small {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-right: 8px;
      filter: drop-shadow(0 0 8px rgba(109, 213, 237, 0.4)) drop-shadow(0 0 16px rgba(109, 213, 237, 0.2));
    }

    .content {
      flex: 1;
      padding: 0 16px;
      overflow-x: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(180deg, rgba(15,21,32,0.85), rgba(15,21,32,0.9));
      border-radius: 24px;
      padding: 24px;
      border: 1px solid var(--accent-border);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35) inset, 0 12px 28px rgba(0,0,0,0.35);
      backdrop-filter: blur(16px);
      display: flex;
      flex-direction: column;
    }
    .question {
      font-size: 16px;
      margin-bottom: 12px;
      color: #cdd6f7;
    }
    .options {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .option {
      margin-bottom: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.04);
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .option:hover {
      background: rgba(255,255,255,0.08);
    }
    .option.selected {
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      color: #031e2e;
      box-shadow: 0 4px 12px rgba(47,128,237,0.5), inset 0 1px 1px rgba(255,255,255,0.3);
    }
    .status {
      margin-top: 12px;
      font-size: 14px;
      color: #9fb3cd;
    }
    .bottom {
      flex: 0 0 auto;
      padding: 14px 16px calc(24px + var(--safe));
      display: flex;
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,0.06);
      margin: 0 12px 12px;
      border-radius: 20px;
    }
    .bottom button {
      flex: 1;
      margin: 0 6px;
      border: none;
      border-radius: 16px;
      padding: 14px 0;
      font-size: 14px;
      font-weight: 800;
      color: var(--text);
      cursor: pointer;
      background-image: linear-gradient(180deg, var(--brand), var(--brand-2));
      box-shadow: 0 8px 24px rgba(47,128,237,0.45), inset 0 1px 0 rgba(255,255,255,0.25);
      transition: transform 0.08s ease, filter 0.2s ease;
      /* 避免移动端按钮文字换行 */
      white-space: nowrap;
    }
    .bottom button:hover { transform: translateY(-2px); filter: brightness(1.1); }
    .bottom button:active { transform: translateY(0); filter: brightness(0.95); }
    
    /* 自定义弹窗样式 */
    .custom-alert {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    .custom-alert-content {
      background: var(--panel);
      border: 1px solid var(--accent-border);
      border-radius: 16px;
      padding: 24px;
      max-width: 320px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }
    .custom-alert-message {
      color: var(--text);
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 20px;
      white-space: pre-line;
    }
    .custom-alert-button {
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(47,128,237,0.3);
      transition: transform 0.08s ease;
    }
    .custom-alert-button:hover {
      transform: translateY(-1px);
    }
    .custom-alert-button:disabled {
      background: linear-gradient(180deg, #666, #555);
      cursor: not-allowed;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transform: none;
    }
    .custom-alert-button:disabled:hover {
      transform: none;
    }
  </style>
  <script src="i18n/i18n-multilang.js"></script>
</head>
<body>
  <script src="js/smart-back.js"></script>
  
  <!-- 自定义弹窗 -->
  <div class="custom-alert" id="customAlert">
    <div class="custom-alert-content">
      <div class="custom-alert-message" id="customAlertMessage"></div>
      <button class="custom-alert-button" id="customAlertButton" onclick="closeCustomAlert()" disabled>
        <span id="customAlertButtonText">确定</span>
        <span id="customAlertCountdown" style="display: none;"></span>
      </button>
    </div>
  </div>
  <div class="container">
    <div class="header">
      <img src="logo_gold7.png" alt="Logo" class="logo-small" />
      <h1>{{content.quiz_tasks_title}}</h1>
    </div>
    <div class="content">
      <div class="card">
        <div class="question" id="question">加载中…</div>
        <ul class="options" id="options"></ul>
        <div class="status" id="status"></div>
      </div>
    </div>
    <div class="bottom">
      <button class="back-btn" onclick="goBack()">← {{buttons.back}}</button>
      <button onclick="selectAnswer()" id="submitBtn" style="display: none;">{{buttons.submit_answer}}</button>
    </div>
  </div>
  <script>
    // 中文题库
    const QUESTIONS_ZH = [
      { 
        q: '你的专属邀请链接有效期是多久？', 
        options: ['24小时', '72小时', '168小时（7天）', '永久'], 
        a: '168小时（7天）',
        wrongMsg: '链接168小时后失效，无法继续邀请；时间内越早引爆，结构成长越快。'
      },
      { 
        q: '"红包"和"7层返利"，哪一句最贴切？', 
        options: ['抢红包才有返利', '红包=今天的快感，返利=结构里明天的长流水', '红包金额决定返利金额', '红包次数越多，层级越深'], 
        a: '红包=今天的快感，返利=结构里明天的长流水',
        wrongMsg: '红包=短促小雨点，来得快去得快；返利=结构水库，自己往下流。\n你要的不是一把伞，而是一座水坝。'
      },
      { 
        q: '你的7层网络里任意一层新增1位"激活"的成员，你拿到？', 
        options: ['随机金额', '$10 / 每层 / 每人', '只有直推(第1层)才有$10', '只有前三层有$10'], 
        a: '$10 / 每层 / 每人',
        wrongMsg: '结构返利是每层每人$10，最多追踪到7层；越会"教下去"，层数越快被点亮。'
      },
      { 
        q: '小算术：你直推2人（第1层=2），他们各自再推2人（第2层=4），全部激活。你拿的结构返利合计？', 
        options: ['$20', '$40', '$60', '$80'], 
        a: '$60',
        wrongMsg: '第1层2×$10=$20，第2层4×$10=$40，合计**$60**。层级一旦动起来，收益叠加非常快。'
      },
      { 
        q: '哪个比喻最贴近"结构优于单打独斗"的本质？', 
        options: ['红包像小雨点，结构像水库', '红包像大奖，结构像运气', '结构全靠偶然', '红包越多，层级越深'], 
        a: '红包像小雨点，结构像水库',
        wrongMsg: '红包是即刻的"小雨点"；结构是能蓄水并持续来水的"水库"——关键是让水沿层级自己流。'
      },
      { 
        q: '想让结构真正"动"起来，下面哪步最关键？', 
        options: ['自己再直推3人', '再抢一轮红包', '改头像、发海报', '教会你的第1层去教TA的下一级'], 
        a: '教会你的第1层去教TA的下一级',
        wrongMsg: '从"会拉人"升级为"会带人去带人"，层数才会级联点亮。'
      },
      { 
        q: '168小时窗口关掉后，你还能留下什么？', 
        options: ['邀请与红包继续', '一切清零', '只能直推有返利', '你搭好的"水库"会自己流，但你再也加不进一滴水'], 
        a: '你搭好的"水库"会自己流，但你再也加不进一滴水',
        wrongMsg: '入口锁死，红包与邀请全灭。\n但你这7天搭的水库，会替你把水流到手里。\n区别只是——别人7天拼出水坝，你还在空杯等雨。'
      },
      { 
        q: '想把结构的"爆炸型增长曲线"真正点燃，最核心的一件事是？', 
        options: ['自己多拉一点', '多发广告', '盯着红包', '把教程下放，让每个节点都会"再教人"'], 
        a: '把教程下放，让每个节点都会"再教人"',
        wrongMsg: '等比爆发来自复制能力的复制，不是个人体力活。'
      },
      { 
        q: '你已直推2位，下一步最增效的是？', 
        options: ['各花30分钟，分别陪他们完成1次首邀', '自己再拉1人', '停几天', '做更酷的宣传图'], 
        a: '各花30分钟，分别陪他们完成1次首邀',
        wrongMsg: '扶上马并送一程，他们就能自己跑、还会带人。'
      },
      { 
        q: '复制思路里，哪句最关键？', 
        options: ['先做满好多天', '每个新人都"带出他的第一单"', '等系统推人', '内容越花越好'], 
        a: '每个新人都"带出他的第一单"',
        wrongMsg: '第一单被带出，他的心气就立住了，复制链条才真正启动。'
      },
      { 
        q: '理想等比：若每人带2个，只到第3层，总人数（不含你）是？', 
        options: ['8', '10', '16', '14'], 
        a: '14',
        wrongMsg: '2+4+8=14；到第3层就能明显感觉越做越轻。'
      },
      { 
        q: '哪种选择更强？', 
        options: ['教2个会教人的人', '一次拉10个但没人会教', '随缘等系统', '只抢即时奖励'], 
        a: '教2个会教人的人',
        wrongMsg: '会教人的种子会长出很多枝丫；10个不会教=很快静默。'
      },
      { 
        q: '如果今天只能做一件事，选哪个？', 
        options: ['把一个新人"带出第一单"', '写一篇长教程', '修一张海报', '刷一小时群'], 
        a: '把一个新人"带出第一单"',
        wrongMsg: '第一单=点火按钮；其余都是铺垫。'
      },
      { 
        q: '真正引爆曲线的本质一刀是？', 
        options: ['我自己更努力', '做更多素材', '让每个新人能带出他的第一单，并教他也这么做', '盯排行榜'], 
        a: '让每个新人能带出他的第一单，并教他也这么做',
        wrongMsg: '爆发来自"会的人越来越多"，不是你一个人更累。'
      },
      { 
        q: '今天只做一件事，哪件最"划算"？', 
        options: ['约1位"最熟的熟人"语音60秒，当场发出首条邀请', '写宣传文案', '修图', '学半天方法论'], 
        a: '约1位"最熟的熟人"语音60秒，当场发出首条邀请',
        wrongMsg: '强关系×当场出手，最快出第一单。'
      },
      { 
        q: '晚上黄金1小时，你该做？', 
        options: ['修图', '写长文', '刷群', '开三通语音：各带1位完成首邀/发出第一条邀请'], 
        a: '开三通语音：各带1位完成首邀/发出第一条邀请',
        wrongMsg: '语音×三次小胜利，效率比素材高太多。'
      },
      { 
        q: '明天最该盯哪项结构指标？', 
        options: ['红包次数', '排名', '私聊人数', '二层新增"首邀达成数"'], 
        a: '二层新增"首邀达成数"',
        wrongMsg: '二层首邀上来，结构才开始"自己跑"。'
      },
      { 
        q: '如果对方犹豫，你最能点燃他的一句话是？', 
        options: ['"你先付钱再说"', '"你慢慢研究"', '"我们先从最稳的一个朋友试起，我全程陪着你"', '"无所谓，看你吧"'], 
        a: '"我们先从最稳的一个朋友试起，我全程陪着你"',
        wrongMsg: '陪跑=信心灌输。\n第一步不是他一个人跳，而是你拉着他过河。\n试点+陪跑，最容易让人点火成功。'
      },
      { 
        q: '首邀成功后，黄金5分钟干嘛？', 
        options: ['放一天', '只发表情', '立刻去拉陌生人', '复盘3句话：怎么说、怎么演示、下一位是谁'], 
        a: '复盘3句话：怎么说、怎么演示、下一位是谁',
        wrongMsg: '复盘→固化→再复制，热度最值钱。'
      },
      { 
        q: '规模化真正的"第一脚油门"？', 
        options: ['我更努力', '多做素材', '让每个新人都能带出他的第一单，并教会他复制这三步', '盯排行榜'], 
        a: '让每个新人都能带出他的第一单，并教会他复制这三步',
        wrongMsg: '爆发来自会的人越来越多，不是你一个人更累。'
      }
    ];
    // 英文题库
    const QUESTIONS_EN = [
      { q: 'How long is your invite link valid?', options: ['24 hours', '72 hours', '168 hours (7 days)', 'Permanent'], a: '168 hours (7 days)', wrongMsg: 'The link expires after 168 hours. The earlier you ignite within the window, the faster the structure grows.' },
      { q: 'Which sentence best describes “Red Packet” and “7-level rebate”?', options: ['Rebate only from red packets', 'Red Packet = today’s thrill, Rebate = tomorrow’s steady flow from your structure', 'Red packet amount decides rebate amount', 'More red packets, deeper levels'], a: 'Red Packet = today’s thrill, Rebate = tomorrow’s steady flow from your structure', wrongMsg: 'Red packets are short showers; rebates are reservoirs flowing down the structure. You don’t need an umbrella; you need a dam.' },
      { q: 'In your 7-level network, when any level adds 1 activated member, what do you earn?', options: ['Random amount', '$10 / per level / per person', '$10 only for direct referrals (level 1)', '$10 only for top 3 levels'], a: '$10 / per level / per person', wrongMsg: 'Structure rebate is $10 per level per person, up to 7 levels. The better you “teach down”, the faster levels light up.' },
      { q: 'Math: you directly refer 2 (L1=2). Each refers 2 (L2=4), all activated. Total structure rebate?', options: ['$20', '$40', '$60', '$80'], a: '$60', wrongMsg: 'L1: 2×$10=$20; L2: 4×$10=$40; total $60. Once levels move, income stacks fast.' },
      { q: 'Which analogy best captures “structure beats solo”?', options: ['Red packet like drizzle, structure like reservoir', 'Red packet like jackpot, structure like luck', 'Structure relies on chance', 'More red packets, deeper levels'], a: 'Red packet like drizzle, structure like reservoir', wrongMsg: 'Red packet is instant drizzle; structure can store and keep flowing—key is letting water flow down levels.' },
      { q: 'To really make the structure “move”, which step is key?', options: ['Directly refer 3 more', 'Grab another red packet', 'Change avatar, post posters', 'Teach your level-1 to teach their next level'], a: 'Teach your level-1 to teach their next level', wrongMsg: 'Upgrade from “can pull” to “can lead others to lead”, then levels cascade.' },
      { q: 'After the 168-hour window closes, what remains?', options: ['Invites and red packets continue', 'Everything resets', 'Only direct referrals have rebate', 'Your reservoir keeps flowing, but you can’t add a single drop'], a: 'Your reservoir keeps flowing, but you can’t add a single drop', wrongMsg: 'Entry locks; red packets and invites stop. But the reservoir built in 7 days keeps flowing to you.' },
      { q: 'To ignite the “explosive growth curve”, what’s the core?', options: ['Pull more yourself', 'Post more ads', 'Stare at red packets', 'Push tutorials downward so every node can “teach again”'], a: 'Push tutorials downward so every node can “teach again”', wrongMsg: 'Geometric explosion comes from capability copying, not personal labor.' },
      { q: 'You’ve directly referred 2. Next most effective step?', options: ['Spend 30 mins each to accompany them to finish the first invite', 'Refer 1 more yourself', 'Pause', 'Make cooler graphics'], a: 'Spend 30 mins each to accompany them to finish the first invite', wrongMsg: 'Help them take off; they’ll run and bring people.' },
      { q: 'In the copy mindset, which is critical?', options: ['Fill many days first', 'Every newbie “makes his first invite”', 'Wait for system push', 'The fancier the content the better'], a: 'Every newbie “makes his first invite”', wrongMsg: 'Once the first invite is out, confidence stands and the copy chain starts.' },
      { q: 'Ideal geometric: if each brings 2, up to level 3, total people (not including you)?', options: ['8', '10', '16', '14'], a: '14', wrongMsg: '2+4+8=14; by level 3 you feel it getting easier.' },
      { q: 'Which is stronger?', options: ['Teach 2 who can teach others', 'Pull 10 at once but none can teach', 'Rely on system', 'Only chase instant rewards'], a: 'Teach 2 who can teach others', wrongMsg: 'Seeds who can teach grow many branches; 10 who can’t teach go silent.' },
      { q: 'If only one task today, choose?', options: ['Help a newbie “make the first invite”', 'Write a long tutorial', 'Fix a poster', 'Chat in groups'], a: 'Help a newbie “make the first invite”', wrongMsg: 'First invite = ignition; others are prep.' },
      { q: 'The one knife to trigger the curve?', options: ['I work harder', 'Make more materials', 'Let every newbie make his first invite and teach him to do so', 'Watch rankings'], a: 'Let every newbie make his first invite and teach him to do so', wrongMsg: 'Explosion comes from more people who know how, not you being more tired.' },
      { q: 'If only one thing today, which is most “cost-effective”?', options: ['Voice-call the closest friend for 60 seconds to send the first invite on the spot', 'Write promo copy', 'Edit images', 'Learn methodology for half a day'], a: 'Voice-call the closest friend for 60 seconds to send the first invite on the spot', wrongMsg: 'Strong ties × act on the spot → fastest first invite.' },
      { q: 'Golden hour at night, do?', options: ['Edit images', 'Write long articles', 'Chat groups', 'Three voice calls: each helps 1 person finish the first invite'], a: 'Three voice calls: each helps 1 person finish the first invite', wrongMsg: 'Voice × small wins ×3 beats materials by far.' },
      { q: 'Which structure metric to watch tomorrow?', options: ['Red packet times', 'Ranking', 'Private chats', 'Level-2 new “first-invite achieved” count'], a: 'Level-2 new “first-invite achieved” count', wrongMsg: 'When level-2 first invites rise, the structure starts “running itself”.' },
      { q: 'If the other hesitates, which sentence ignites him?', options: ['“Pay first then talk”', '“Go research slowly”', '“Let’s try the most reliable friend now, I’ll accompany you throughout”', '“Whatever, up to you”'], a: '“Let’s try the most reliable friend now, I’ll accompany you throughout”', wrongMsg: 'Accompany = confidence injection. Pilot + accompany → easiest ignition.' },
      { q: 'After first invite succeeds, golden 5 minutes do?', options: ['Wait a day', 'Only emojis', 'Immediately reach strangers', 'Review 3 lines: how to say, how to demo, who’s next'], a: 'Review 3 lines: how to say, how to demo, who’s next', wrongMsg: 'Review → solidify → copy; heat is precious.' },
      { q: 'The true “first pedal” of scaling?', options: ['I work harder', 'Make more materials', 'Let every newbie make his first invite and teach him to copy these 3 steps', 'Watch rankings'], a: 'Let every newbie make his first invite and teach him to copy these 3 steps', wrongMsg: 'Scaling comes from more people who know how, not you being more tired.' }
    ];
    // 语言设置；若英文题库未定义则回退到中文题库
    const RAW_LANG = localStorage.getItem('preferred-language') || localStorage.getItem('language') || 'zh-CN';
    const LANG = RAW_LANG;
    const IS_EN = (RAW_LANG || '').toLowerCase().startsWith('en');
    const QUESTIONS = (IS_EN && typeof QUESTIONS_EN !== 'undefined') ? QUESTIONS_EN : QUESTIONS_ZH;
    let currentIndex = 0;
    let correctCount = 0;
    let selectedOption = null;
    function loadProgress() {
      const idx = parseInt(localStorage.getItem('quizIndex'));
      const cnt = parseInt(localStorage.getItem('quizCorrect'));
      if (!isNaN(idx)) currentIndex = idx;
      if (!isNaN(cnt)) correctCount = cnt;
    }
    function saveProgress() {
      localStorage.setItem('quizIndex', currentIndex);
      localStorage.setItem('quizCorrect', correctCount);
      // 更新手续费比例：5% - 正确题数*0.2%，最低1%
      let rate = 0.05 - correctCount * 0.002;
      if (rate < 0.01) rate = 0.01;
      localStorage.setItem('withdrawFeeRate', rate.toFixed(4));
    }
    function renderQuestion() {
      // 已完成所有题目 / All completed
      if (correctCount >= 20 || currentIndex >= QUESTIONS.length) {
        document.getElementById('question').innerText = (IS_EN ? 'Quiz Completed' : '答题任务完成');
        document.getElementById('options').innerHTML = '';
        const rateStr = (parseFloat(localStorage.getItem('withdrawFeeRate'))*100).toFixed(1);
        document.getElementById('status').innerText = (IS_EN ? `Answered ${correctCount} correct, withdrawal fee reduced to ${rateStr}%` : `你答对了 ${correctCount} 题，提现手续费已降至 ${rateStr}%。`);
        document.getElementById('submitBtn').style.display = 'none';
        const bottomDiv = document.querySelector('.bottom');
        bottomDiv.style.display = 'flex';
        bottomDiv.innerHTML = `<button onclick="goBack()" style="background: linear-gradient(180deg, #4CAF50, #45a049);">{{buttons.back}}</button>`;
        return;
      }
      const q = QUESTIONS[currentIndex];
      const prefix = (IS_EN ? 'Question' : '第');
      const mid = (IS_EN ? '' : ' ');
      const colon = (IS_EN ? ':' : ' 题：');
      document.getElementById('question').innerText = (IS_EN ? `${prefix} ${currentIndex+1}${colon} ${q.q}` : `${prefix}${mid}${currentIndex+1}${colon}${q.q}`);
      const ul = document.getElementById('options');
      ul.innerHTML = '';
      q.options.forEach(opt => {
        const li = document.createElement('li');
        li.className = 'option';
        li.innerText = opt;
        li.addEventListener('click', () => {
          document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
          li.classList.add('selected');
          selectedOption = opt;
          setTimeout(() => { selectAnswer(); }, 300);
        });
        ul.appendChild(li);
      });
      const rateStr = (parseFloat(localStorage.getItem('withdrawFeeRate'))*100).toFixed(1);
      document.getElementById('status').innerText = (IS_EN ? `Answered ${correctCount} correct, fee ${rateStr}%` : `已答对 ${correctCount} 题，手续费 ${rateStr}%`);
    }
    function goBack() {
      // 返回到上一级页面（主页面）
      window.location.href = 'index.html';
    }
    
    function selectAnswer() {
      if (correctCount >= 20) {
        // 答题完成，返回主页并更新状态
        const appState = JSON.parse(localStorage.getItem('appState') || '{}');
        appState.quizCompleted = true;
        appState.withdrawFeeRate = parseFloat(localStorage.getItem('withdrawFeeRate'));
        localStorage.setItem('appState', JSON.stringify(appState));
        window.location.href = 'index.html';
        return;
      }
      
      const q = QUESTIONS[currentIndex];
      // 移除选择检查，因为点击选项就直接提交了
      if (!selectedOption) {
        return; // 如果没有选择就直接返回，不显示提示
      }
      
      if (selectedOption === q.a) {
        // 正确 / Correct
        correctCount++;
        currentIndex++;
        selectedOption = null;
        saveProgress();
        if (correctCount >= 20) {
          const appState = JSON.parse(localStorage.getItem('appState') || '{}');
          appState.quizCompleted = true;
          appState.withdrawFeeRate = parseFloat(localStorage.getItem('withdrawFeeRate'));
          const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
          transactions.push({ type: 'task_reward', amount: 0, description: (LANG === 'en-US' ? 'Completed quiz, withdrawal fee reduced to ' : '完成答题任务，提现手续费降至') + (appState.withdrawFeeRate * 100).toFixed(1) + '%', timestamp: new Date().toISOString() });
          localStorage.setItem('transactions', JSON.stringify(transactions));
          localStorage.setItem('appState', JSON.stringify(appState));
          const activationTime = localStorage.getItem('activationTime') || new Date().toISOString();
          const remainingHours = Math.max(0, 168 - Math.floor((new Date() - new Date(activationTime)) / (1000 * 60 * 60)));
          const msg = IS_EN
            ? `✅ You completed 【20/20】 quiz!\nMindset upgraded: Red Packet = drizzle, Structure = reservoir, Copy = explosive curve.\nYou’re not just a player; you’re a 【growth engine】.\n**Only ${remainingHours} hours left** for entry — accompany a newbie to make the first invite now!`
            : `✅ 你已完成【20/20】道裂金测验！\n你的财富思维已升维：红包=小雨点，结构=水库，复制=爆炸曲线。\n你不只是玩家，你是【裂变引擎】。\n**入口只剩 ${remainingHours} 小时**，立即陪新人完成【第一单】，让水库自动奔流！`;
          showCustomAlert(msg, true, true);
        } else {
          showCustomAlert(IS_EN ? 'Correct! Withdrawal fee decreased by 0.2%.' : '回答正确！提现手续费降低0.2%。', false, false);
        }
      } else {
        showCustomAlert(q.wrongMsg || (IS_EN ? `Incorrect. Correct answer: ${q.a}` : `回答错误，正确答案是：${q.a}`), false, true);
        selectedOption = null;
      }
      renderQuestion();
    }
    loadProgress();
    // 初始化提现费率如果未设置
    if (!localStorage.getItem('withdrawFeeRate')) {
      localStorage.setItem('withdrawFeeRate', '0.05');
    }
    renderQuestion();
    
    // 自定义弹窗函数
    function showCustomAlert(message, isCompleteQuiz = false, needCountdown = false) {
          document.getElementById('customAlertMessage').textContent = message;
          document.getElementById('customAlert').style.display = 'flex';
          
          const button = document.getElementById('customAlertButton');
          const buttonText = document.getElementById('customAlertButtonText');
          const countdown = document.getElementById('customAlertCountdown');
          
          // 如果不需要倒计时，直接激活按钮
          if (!needCountdown) {
            button.disabled = false;
            buttonText.style.display = 'inline';
            countdown.style.display = 'none';
            return;
          }
          
          // 设置倒计时时间：答错题3秒，完成测验5秒
          const countdownTime = isCompleteQuiz ? 5 : 3;
          let remainingTime = countdownTime;
          
          // 初始化按钮状态
          button.disabled = true;
          buttonText.style.display = 'none';
          countdown.style.display = 'inline';
          countdown.textContent = (LANG === 'en-US' ? `${remainingTime}s` : `${remainingTime}秒`);
          const timer = setInterval(() => {
            remainingTime--;
            if (remainingTime > 0) {
              countdown.textContent = (LANG === 'en-US' ? `${remainingTime}s` : `${remainingTime}秒`);
            } else {
              // 倒计时结束，激活按钮
              clearInterval(timer);
              button.disabled = false;
              buttonText.style.display = 'inline';
              countdown.style.display = 'none';
            }
          }, 1000);
        }
    
    function closeCustomAlert() {
      document.getElementById('customAlert').style.display = 'none';
    }
  </script>
  <script src="js/global-background.js"></script>
</body>
</html>